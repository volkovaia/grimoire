<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Каталог заклинаний</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Alfa+Slab+One&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<nav>
    <a href="/dashboard.html"><i class="fas fa-house"></i> Кабинет</a>
    <a href="/spells.html"><i class="fas fa-hat-wizard"></i> Заклинания</a>
    <a href="/artifacts.html"><i class="fas fa-crown"></i> Артефакты</a>
    <a href="/history.html"><i class="fas fa-scroll"></i> История</a>
    <a href="/spell-cast.html"><i class="fas fa-wand-magic-sparkles"></i> Наложение заклинаний</a>
    <a href="#" onclick="logout(); return false;"><i class="fas fa-right-from-bracket"></i> Выйти</a>
</nav>

<div class="magic-header">
    <h2><i class="fas fa-spell-check"></i> Каталог всех заклинаний</h2>
    <div class="magic-moon"><i class="fas fa-star"></i></div>
</div>

<div id="spellsContainer">
    <p>Загрузка заклинаний...</p>
</div>

<script src="/js/api.js"></script>
<script>
    async function loadSpells() {
        try {
            checkAuth();
            const spells = await api.getAllSpells(0, 100);
            const wizard = await api.getWizard();
            const container = document.getElementById('spellsContainer');


            if (spells.content.length === 0) {
                container.innerHTML = `
                    <div class="no-records">
                        <i class="fas fa-book"></i>
                        <p>В гримуаре нет записанных заклинаний.</p>
                    </div>
                `;
                return;
            }

            const rows = spells.content.map(spell => {
                const isAvailable = spell.requiredGuildLevel <= wizard.guildLevel;
                const actionBtn = isAvailable
                    ? `<a href="/spell-cast.html?spellId=${spell.idSpell}" class="btn" style="display:inline-block;padding:6px 14px;font-size:0.95em;background:#5d4037;color:#e0d6c5;text-decoration:none;border-radius:4px;">
                        <i class="fas fa-bolt"></i> Наложить
                      </a>`
                    : `<span style="color:#888;"><i class="fas fa-lock"></i> Недоступно</span>`;

                const typeHtml = {
                    'attack': `<span style="color:#ff5252;"><i class="fas fa-skull-crossbones"></i> Атака</span>`,
                    'defense': `<span style="color:#4caf50;"><i class="fas fa-shield-halved"></i> Защита</span>`,
                    'control': `<span style="color:#2196f3;"><i class="fas fas fa-hand-sparkles"></i> Контроль</span>`
                }[spell.type] || `<span>${spell.type}</span>`;

                return `
                    <tr>
                        <td>${spell.name}</td>
                        <td>${spell.requiredGuildLevel}</td>
                        <td>${typeHtml}</td>
                        <td>${actionBtn}</td>
                    </tr>
                `;
            }).join('');

            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th><i class="fas fa-tag"></i> Название</th>
                            <th><i class="fas fa-level-up-alt"></i> Уровень</th>
                            <th><i class="fas fa-fire"></i> Тип</th>
                            <th><i class="fas fa-wand-magic"></i> Действие</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rows}
                    </tbody>
                </table>
            `;
        } catch (err) {
            container.innerHTML = `<p class="message error">Ошибка: ${err.message}</p>`;
        }
    }

    function logout() {
        localStorage.removeItem('token');
        localStorage.removeItem('wizardId');
        localStorage.removeItem('wizardLogin');
        window.location.href = '/login.html';
    }

    loadSpells();
</script>
</body>
</html>