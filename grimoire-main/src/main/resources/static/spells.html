<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>–ö–∞—Ç–∞–ª–æ–≥ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Alfa+Slab+One&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<nav>
    <a href="/dashboard.html"><i class="fas fa-house"></i> –ö–∞–±–∏–Ω–µ—Ç</a>
    <a href="/spells.html"><i class="fas fa-hat-wizard"></i> –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è</a>
    <a href="/artifacts.html"><i class="fas fa-crown"></i> –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</a>
    <a href="/history.html"><i class="fas fa-scroll"></i> –ò—Å—Ç–æ—Ä–∏—è</a>
    <a href="/spell-cast.html"><i class="fas fa-wand-magic-sparkles"></i> –ù–∞–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π</a>
    <a href="#" onclick="logout(); return false;"><i class="fas fa-right-from-bracket"></i> –í—ã–π—Ç–∏</a>
</nav>

<div class="magic-header">
    <h2><i class="fas fa-spell-check"></i> –ö–∞—Ç–∞–ª–æ–≥ –≤—Å–µ—Ö –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π</h2>
    <div class="magic-moon"><i class="fas fa-star"></i></div>
</div>

<div id="spellsContainer">
    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π...</p>
</div>

<script src="/js/api.js"></script>
<script>
    /**
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML —Å –∏–∫–æ–Ω–∫–æ–π –¥–ª—è —Ç–∏–ø–∞ –∂–µ—Ä—Ç–≤—ã.
     * @param {string} victimType –¢–∏–ø –∂–µ—Ä—Ç–≤—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, WIZARD, HUMAN, BOTH).
     * @returns {string} HTML —Å –∏–∫–æ–Ω–∫–æ–π –∏ —Ç–µ–∫—Å—Ç–æ–º.
     */
    function getVictimTypeHtml(victimType) {
        const type = (victimType || '').toUpperCase();
        let icon = '';
        let color = '#d4af37'; // –ñ–µ–ª—Ç—ã–π/–∑–æ–ª–æ—Ç–æ–π
        let text = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

        switch(type) {
            case 'WIZARD':
                icon = 'fa-hat-wizard';
                color = '#5bc0de'; // –ì–æ–ª—É–±–æ–π
                text = '–í–æ–ª—à–µ–±–Ω–∏–∫';
                break;
            case 'HUMAN':
                icon = 'fa-user';
                color = '#f0ad4e'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π
                text = '–ß–µ–ª–æ–≤–µ–∫';
                break;
            case 'BOTH':
                icon = 'fa-users';
                color = '#62c462'; // –ó–µ–ª–µ–Ω—ã–π
                text = '–û–±–∞';
                break;
            default:
                icon = 'fa-question';
                text = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        }

        return `<span style="color:${color};"><i class="fas ${icon}" title="${text}"></i> ${text}</span>`;
    }

    async function loadSpells() {
        try {
            checkAuth();
            const spells = await api.getAllSpells(0, 100);
            const wizard = await api.getWizard();
            const container = document.getElementById('spellsContainer');

            if (spells.content.length === 0) {
                container.innerHTML = `
                    <div class="no-records">
                        <i class="fas fa-book"></i>
                        <p>–í –≥—Ä–∏–º—É–∞—Ä–µ –Ω–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π.</p>
                    </div>
                `;
                return;
            }

            const rows = spells.content.map(spell => {
                const isAvailable = spell.requiredGuildLevel <= wizard.guild.level;

                const descriptionHtml = `<br><span style="font-size: 0.9em; color: #aaa; font-style: italic;">${spell.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è.'}</span>`;

                // üí° –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 1: –î–æ–±–∞–≤–ª—è–µ–º victimType –∏–∑ –±—ç–∫–µ–Ω–¥–∞ (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º camelCase)
                // –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ spell.victim_type
                const victimTypeDisplay = getVictimTypeHtml(spell.victimType);

                const actionBtn = isAvailable
                    ? `<a href="/spell-cast.html?spellId=${spell.id}" class="btn" style="display:inline-block;padding:6px 14px;font-size:0.95em;background:#5d4037;color:#e0d6c5;text-decoration:none;border-radius:4px;">
                        <i class="fas fa-bolt"></i> –ù–∞–ª–æ–∂–∏—Ç—å
                      </a>`
                    : `<span style="color:#888;"><i class="fas fa-lock"></i> –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>`;

                const typeHtml = {
                    'ATTACK': `<span style="color:#ff5252;"><i class="fas fa-skull-crossbones"></i> –ê—Ç–∞–∫–∞</span>`,
                    'DEFENSE': `<span style="color:#4caf50;"><i class="fas fa-shield-halved"></i> –ó–∞—â–∏—Ç–∞</span>`,
                    'CONTROL': `<span style="color:#2196f3;"><i class="fas fa-hand-sparkles"></i> –ö–æ–Ω—Ç—Ä–æ–ª—å</span>`,
                    'UTILITY': `<span style="color:#ffd700;"><i class="fas fa-star"></i> UTILITY</span>`,
                    'CURSE': `<span style="color:#9c27b0;"><i class="fas fa-ban"></i> CURSE</span>`,
                    'NECROMANCY': `<span style="color:#008080;"><i class="fas fa-skull"></i> NECROMANCY</span>`,
                    'ILLUSION': `<span style="color:#6a5acd;"><i class="fas fa-eye"></i> ILLUSION</span>`,
                    'BUFF': `<span style="color:#ffc107;"><i class="fas fa-arrow-up"></i> BUFF</span>`,
                    'FORBIDDEN_MAGIC': `<span style="color:#800000; font-weight: bold;"><i class="fas fa-exclamation-triangle"></i> –ó–ê–ü–†–ï–©.</span>`,

                }[spell.type] || `<span>${spell.type}</span>`;

                // üí° –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–¥–∞–ª—è–µ–º —Å—Ç–æ–ª–±–µ—Ü "–î–µ–π—Å—Ç–≤–∏–µ"
                return `
                    <tr>
                        <td>${spell.name}${descriptionHtml}</td>
                        <td>${spell.requiredGuildLevel}</td>
                        <td>${typeHtml}</td>
                        <td>${victimTypeDisplay}</td>
                    </tr>
                `;
            }).join('');

            // üí° –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã (<thead>) - –£–ë–ò–†–ê–ï–ú "–î–ï–ô–°–¢–í–ò–ï"
            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th><i class="fas fa-tag"></i> –ù–∞–∑–≤–∞–Ω–∏–µ / –û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th><i class="fas fa-level-up-alt"></i> –£—Ä–æ–≤–µ–Ω—å</th>
                            <th><i class="fas fa-fire"></i> –¢–∏–ø</th>
                            <th><i class="fas fa-user"></i> –ñ–µ—Ä—Ç–≤–∞</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rows}
                    </tbody>
                </table>
            `;
        } catch (err) {
            container.innerHTML = `<p class="message error">–û—à–∏–±–∫–∞: ${err.message}</p>`;
        }
    }

    function logout() {
        localStorage.removeItem('token');
        localStorage.removeItem('wizardId');
        localStorage.removeItem('wizardLogin');
        window.location.href = '/login.html';
    }

    loadSpells();
</script>
</body>
</html>